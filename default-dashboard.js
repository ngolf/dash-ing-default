var e={version:"Version"},t={common:e};const a={en:Object.freeze({__proto__:null,common:e,default:t})};const s=(e,...t)=>{console.info(`%c  DEFAULT-DASHBOARD \n%c  ${e}   `,"color: orange; font-weight: bold; background: black","font-weight: bold;",...t)},n={defaultPanel:"",isDefaultPanelManaged:""};Object.keys(n).forEach(e=>{n[e]=e});class l{constructor(e){this.getDashboards=async()=>this.hass.callWS({type:"lovelace/dashboards/list"}),this.createInputBoolean=async()=>await this.hass.callWS({type:"input_boolean/create",name:"Default Dashboard"}),this.createInputSelect=async()=>{const e=await this.getDashboards().then(e=>e.filter(e=>!e.require_admin).flatMap(e=>e.url_path));return await this.hass.callWS({type:"input_select/create",name:"Default Dashboard",options:["lovelace",...e,"refresh"]})},this.getStorageSettings=async()=>({defaultPanel:localStorage.getItem(n.defaultPanel),isDefaultPanelManaged:localStorage.getItem(n.isDefaultPanelManaged)}),this.setDefaultPanel=async e=>{localStorage.setItem(n.defaultPanel,e),localStorage.setItem(n.isDefaultPanelManaged,"true")},this.disable=async()=>{localStorage.setItem(n.isDefaultPanelManaged,"false")},this.enable=async()=>{localStorage.setItem(n.isDefaultPanelManaged,"true")},this.hass=e}}s(`${function(e,t="",s=""){const n=(localStorage.getItem("selectedLanguage")||"en").replace(/['"]+/g,"").replace("-","_");let l;try{l=e.split(".").reduce((e,t)=>e[t],a[n])}catch(t){l=e.split(".").reduce((e,t)=>e[t],a.en)}return void 0===l&&(l=e.split(".").reduce((e,t)=>e[t],a.en)),""!==t&&""!==s&&(l=l.replace(t,s)),l}("common.version")} 1.1.0`);const o="default_dashboard",i=`input_select.${o}`,c=`input_boolean.${o}`,r="lovelace";let d;const u=async()=>{const e=await d.getDashboards(),t={};return e.forEach(e=>{t[e.url_path]=!0}),t},h=async e=>!(!e||!await(async()=>null===(await d.getStorageSettings()).isDefaultPanelManaged&&(await d.enable(),!0))())&&(s("Default Dashboard Enabled"),!0);(async()=>{for(;void 0===customElements.get("home-assistant");)await new Promise(e=>window.setTimeout(e,100));const e=document.getElementsByTagName("home-assistant")[0].hass;let t=0;for(;(!e.states||0===Object.keys(e.states).length)&&t<30;)await new Promise(e=>window.setTimeout(e,1e3)),t++;d=new l(e),window.addEventListener("hass-default-panel",e=>{"lovelace"===e.detail.defaultPanel?d.enable():d.disable()});const{url:a,enabled:n}=await(async e=>{let t=e.states[i]?.state,a=e.states[c]?.state;if(void 0===t)try{await d.createInputSelect(),s(`Created a Dropdown helper with the id \`${i}\``),await new Promise(e=>setTimeout(e,1e3)),t=e.states[i]?.state}catch(e){s(`Could not create dropdown helper: ${e}`)}if(void 0===a)try{await d.createInputBoolean(),s(`Created a Toggle helper with the id \`${c}\``),await new Promise(e=>setTimeout(e,1e3)),a=e.states[c]?.state}catch(e){s(`Could not create toggle helper: ${e}`)}return{url:t,enabled:"on"===a}})(e);if(a){if("refresh"===a){s("Setting dropdown options");const t=await u();return await(async(e,t)=>e.callService("input_select","set_options",{options:t},{entity_id:i}))(e,[r,...Object.keys(t),"refresh"]),void await(async(e,t)=>e.callService("input_select","select_option",{option:t},{entity_id:i}))(e,r)}await h(n),await(async e=>{const t=`"${e}"`,a=await d.getStorageSettings(),n="false"===a.isDefaultPanelManaged||null===a.isDefaultPanelManaged,l=await u();n||(l[e]||e===r)&&a.defaultPanel!==t&&(s(`Setting default panel to ${t}`),await d.setDefaultPanel(t),location.replace("/"))})(a)}})();
